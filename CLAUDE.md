# WeKnora - é¡¹ç›®åˆ†æä¸å¼€å‘æŒ‡å—

> æœ¬æ–‡æ¡£ç”± Claude Code è‡ªåŠ¨ç”Ÿæˆï¼ŒåŸºäºå¯¹ WeKnora é¡¹ç›®çš„å…¨é¢åˆ†æ

##  ï¸ é¡¹ç›®æ¶æ„æ¦‚è§ˆ

WeKnora æ˜¯ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ–‡æ¡£ç†è§£ä¸è¯­ä¹‰æ£€ç´¢æ¡†æ¶ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„æ„å»ºå®Œæ•´çš„ RAG æµæ°´çº¿ã€‚

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **åç«¯**: Go 1.24 + Gin æ¡†æ¶ + Uber Dig ä¾èµ–æ³¨å…¥
- **å‰ç«¯**: Vue 3 + TypeScript + TDesign UI + Vite
- **æ–‡æ¡£è§£æ**: Python gRPC å¾®æœåŠ¡
- **åŸºç¡€è®¾æ–½**: Docker + Docker Compose
- **æ•°æ®åº“**: PostgreSQL (pgvector) + Redis + Neo4j
- **å­˜å‚¨**: MinIO (å¯¹è±¡å­˜å‚¨)
- **ç›‘æ§**: Jaeger (åˆ†å¸ƒå¼è¿½è¸ª)

##  ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
WeKnora/
â”œâ”€â”€ cmd/server/                 # Go åº”ç”¨å…¥å£
â”‚    â””â”€â”€ main.go                 # ä¸»ç¨‹åºå…¥å£ï¼Œä¾èµ–æ³¨å…¥å®¹å™¨åˆå§‹åŒ–
â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.yaml             # æœåŠ¡é…ç½®ï¼ˆå¯¹è¯é…ç½®ã€æç¤ºè¯æ¨¡æ¿ç­‰ï¼‰
â”œâ”€â”€ docker/                     # Docker æ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ Dockerfile.app          # åç«¯åº”ç”¨é•œåƒ
â”‚    â””â”€â”€ Dockerfile.docreader    # æ–‡æ¡£è§£ææœåŠ¡é•œåƒ
â”œâ”€â”€ frontend/                   # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/                    # æºç ç›®å½•
â”‚   â”‚   â”œâ”€â”€ views/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/           # èŠå¤©ç•Œé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/      # çŸ¥è¯†åº“ç®¡ç†
â”‚   â”‚   â”‚    â””â”€â”€ settings/       # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚   â”œâ”€â”€ components/         # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/             # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/                # API æ¥å£å®šä¹‰
â”‚   â”‚    â””â”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ package.json            # å‰ç«¯ä¾èµ–ç®¡ç†
â”‚    â””â”€â”€ vite.config.ts          # Vite æ„å»ºé…ç½®
â”œâ”€â”€ internal/                   # Go å†…éƒ¨åŒ…ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ application/            # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ repository/         # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ service/            # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚    â””â”€â”€ chat_pipline/       # èŠå¤©æµæ°´çº¿æ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ handler/                # HTTP è¯·æ±‚å¤„ç†å™¨
â”‚   â”œâ”€â”€ middleware/             # Gin ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ models/                 # æ¨¡å‹å®šä¹‰ï¼ˆLLMã€Embedding ç­‰ï¼‰
â”‚   â”œâ”€â”€ router/                 # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ types/                  # ç±»å‹å®šä¹‰å’Œæ¥å£
â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”œâ”€â”€ migrations/                 # æ•°æ®åº“è¿ç§»è„šæœ¬
â”œâ”€â”€ scripts/                    # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ services/                   # å¾®æœåŠ¡å®ç°
â”‚    â””â”€â”€ docreader/              # Python æ–‡æ¡£è§£ææœåŠ¡
â””â”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒæ¨¡å—åˆ†æ

### åç«¯æ¶æ„ (Go)

#### 1. ä¾èµ–æ³¨å…¥ç³»ç»Ÿ (`internal/container/`)
- ä½¿ç”¨ Uber Dig å®ç°ä¾èµ–æ³¨å…¥
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸ
- æ”¯æŒæ¥å£éš”ç¦»å’Œæ¨¡å—åŒ–æµ‹è¯•

#### 2. èŠå¤©æµæ°´çº¿ç³»ç»Ÿ (`internal/application/service/chat_pipline/`)
- æ’ä»¶åŒ–æ¶æ„ï¼Œæ”¯æŒäº‹ä»¶é©±åŠ¨å¤„ç†
- ä¸»è¦äº‹ä»¶ç±»å‹ï¼šé¢„å¤„ç†ã€æ£€ç´¢ã€é‡æ’ã€ç”Ÿæˆç­‰
- æ”¯æŒç†”æ–­æœºåˆ¶å’Œé”™è¯¯å¤„ç†

#### 3. æ£€ç´¢å¼•æ“ (`internal/application/service/retriever/`)
- æ··åˆæ£€ç´¢ç­–ç•¥ï¼šå‘é‡æ£€ç´¢ + å…³é”®è¯æ£€ç´¢
- æ”¯æŒå¤šç§å‘é‡æ•°æ®åº“åç«¯
- åŸºäºæ¥å£çš„æ’ä»¶åŒ–è®¾è®¡

#### 4. API è·¯ç”± (`internal/router/`)
- RESTful API è®¾è®¡
- è®¤è¯ä¸­é—´ä»¶å’Œæƒé™æ§åˆ¶
- ä¸€è‡´çš„é”™è¯¯å¤„ç†æœºåˆ¶

### å‰ç«¯æ¶æ„ (Vue 3)

#### 1. è·¯ç”±é…ç½® (`frontend/src/router/index.ts`)
- åŸºäºæ–‡ä»¶çš„è·¯ç”±é…ç½®
- è·¯ç”±å®ˆå«å®ç°è®¤è¯æ£€æŸ¥
- æ”¯æŒçŸ¥è¯†åº“çº§åˆ«çš„è·¯ç”±åµŒå¥—

#### 2. çŠ¶æ€ç®¡ç† (`frontend/src/stores/`)
- ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†
- æ¨¡å—åŒ–çŠ¶æ€è®¾è®¡ï¼šè®¤è¯ã€çŸ¥è¯†åº“ã€èœå•ç­‰
- ç±»å‹å®‰å…¨çš„ TypeScript æ”¯æŒ

#### 3. ç»„ä»¶è®¾è®¡
- åŸºäº TDesign Vue Next ç»„ä»¶åº“
- æ¨¡å—åŒ–ç»„ä»¶è®¾è®¡ï¼ŒèŒè´£å•ä¸€
- æ”¯æŒå“åº”å¼å¸ƒå±€å’Œä¸»é¢˜å®šåˆ¶

### æ–‡æ¡£è§£æå¾®æœåŠ¡ (Python)

#### 1. gRPC æœåŠ¡è®¾è®¡ (`services/docreader/src/server/server.py`)
- åŸºäº gRPC çš„é«˜æ€§èƒ½æ–‡æ¡£è§£æ
- æ”¯æŒå¤šæ ¼å¼æ–‡æ¡£ï¼šPDFã€Wordã€å›¾ç‰‡ã€ç½‘é¡µç­‰
- å¤šæ¨¡æ€å¤„ç†æ”¯æŒ OCR å’Œå›¾åƒå­—å¹•

#### 2. è§£æå™¨æ¶æ„ (`services/docreader/src/parser/`)
- æ’ä»¶åŒ–æ–‡æ¡£è§£æå™¨
- æ”¯æŒåˆ†å—é…ç½®å’Œè‡ªå®šä¹‰åˆ†éš”ç¬¦
- é›†æˆè§†è§‰è¯­è¨€æ¨¡å‹ (VLM) å¤„ç†å›¾åƒ

##  ğŸš€ å¼€å‘ç¯å¢ƒé…ç½®

### 1. ç¯å¢ƒè¦æ±‚
```bash
# å¿…å¤‡å·¥å…·
Docker & Docker Compose
Git
Go 1.24+ (åç«¯å¼€å‘)
Node.js 18+ (å‰ç«¯å¼€å‘)
Python 3.8+ (æ–‡æ¡£è§£ææœåŠ¡å¼€å‘)
```

### 2. å¿«é€Ÿå¯åŠ¨
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Tencent/WeKnora.git
cd WeKnora

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶è®¾ç½®å¿…è¦å‚æ•°

# å¯åŠ¨å®Œæ•´æœåŠ¡æ ˆ
./scripts/start_all.sh

# æˆ–ä½¿ç”¨ Makefile
make start-all
```

### 3. å¼€å‘æ¨¡å¼å¯åŠ¨
```bash
# ä»…å¯åŠ¨åŸºç¡€è®¾æ–½æœåŠ¡
docker-compose up postgres redis minio neo4j jaeger

# åç«¯å¼€å‘æ¨¡å¼ (çƒ­é‡è½½)
cd cmd/server
go run main.go

# å‰ç«¯å¼€å‘æ¨¡å¼
cd frontend
npm install
npm run dev

# æ–‡æ¡£è§£ææœåŠ¡å¼€å‘
cd services/docreader
poetry install
python src/server/server.py
```

## ğŸ”Œ å…³é”®é…ç½®æ–‡ä»¶

### 1. åç«¯é…ç½® (`config/config.yaml`)
- æœåŠ¡å™¨ç«¯å£å’Œä¸»æœºé…ç½®
- å¯¹è¯æœåŠ¡å‚æ•°ï¼ˆé‡å†™ã€é‡æ’é˜ˆå€¼ç­‰ï¼‰
- æç¤ºè¯æ¨¡æ¿é…ç½®
- çŸ¥è¯†åº“åˆ†å—é…ç½®

### 2. Docker ç¼–æ’ (`docker-compose.yml`)
- å¾®æœåŠ¡å®¹å™¨å®šä¹‰å’Œç½‘ç»œé…ç½®
- ç¯å¢ƒå˜é‡æ³¨å…¥å’Œå¥åº·æ£€æŸ¥
- æ•°æ®å·æŒä¹…åŒ–é…ç½®

### 3. Makefile æ„å»ºç³»ç»Ÿ
- å¤šå¹³å° Docker é•œåƒæ„å»º
- æ•°æ®åº“è¿ç§»å’Œæ¸…ç†
- å¼€å‘å·¥å…·é“¾é›†æˆ

##  ğŸ“Š æ•°æ®æ¨¡å‹æ¦‚è§ˆ

### æ ¸å¿ƒå®ä½“å…³ç³»
```
Tenant (ç§Ÿæˆ·)
    â†“
KnowledgeBase (çŸ¥è¯†åº“) â†’ EmbeddingModel (åµŒå…¥æ¨¡å‹)
    â†“
Knowledge (çŸ¥è¯†) â†’ Chunk (åˆ†å—)
    â†“
Session (ä¼šè¯) â†’ Message (æ¶ˆæ¯)
```

### ä¸»è¦æ•°æ®åº“è¡¨
- `knowledge_bases`: çŸ¥è¯†åº“å…ƒæ•°æ®
- `knowledge`: çŸ¥è¯†æ–‡æ¡£ä¿¡æ¯
- `chunks`: æ–‡æ¡£åˆ†å—å†…å®¹ï¼ˆå‘é‡åŒ–å­˜å‚¨ï¼‰
- `sessions`: èŠå¤©ä¼šè¯
- `messages`: å¯¹è¯æ¶ˆæ¯å†å²

##  ğŸ” API æ¥å£æ¦‚è§ˆ

### è®¤è¯ç›¸å…³ (`/api/v1/auth/*`)
- `POST /auth/login` - ç”¨æˆ·ç™»å½•
- `POST /auth/register` - ç”¨æˆ·æ³¨å†Œ
- `GET /auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### çŸ¥è¯†åº“ç®¡ç† (`/api/v1/knowledge-bases/*`)
- `POST /knowledge-bases` - åˆ›å»ºçŸ¥è¯†åº“
- `GET /knowledge-bases` - è·å–çŸ¥è¯†åº“åˆ—è¡¨
- `GET /knowledge-bases/:id/hybrid-search` - æ··åˆæœç´¢

### æ–‡æ¡£ç®¡ç† (`/api/v1/knowledge/*`)
- `POST /knowledge-bases/:id/knowledge/file` - æ–‡ä»¶ä¸Šä¼ 
- `POST /knowledge-bases/:id/knowledge/url` - URL å¯¼å…¥
- `GET /knowledge/:id` - è·å–çŸ¥è¯†è¯¦æƒ…

### å¯¹è¯æ¥å£ (`/api/v1/knowledge-chat/*`)
- `POST /knowledge-chat/:session_id` - çŸ¥è¯†é—®ç­”
- `POST /knowledge-search` - çŸ¥è¯†æ£€ç´¢

##  ğŸ› ï¸ å¼€å‘æ‰©å±•æŒ‡å—

### 1. æ·»åŠ æ–°çš„æ£€ç´¢ç­–ç•¥
1. åœ¨ `internal/types/interfaces/retriever.go` å®šä¹‰æ¥å£
2. åœ¨ `internal/application/service/retriever/` å®ç°æ£€ç´¢å™¨
3. åœ¨ `internal/application/service/retriever/registry.go` æ³¨å†Œ
4. é…ç½®ç§Ÿæˆ·çš„æ£€ç´¢å™¨å¼•æ“

### 2. æ‰©å±•æ–‡æ¡£è§£ææ ¼å¼
1. åœ¨ `services/docreader/src/parser/` æ·»åŠ æ–°çš„è§£æå™¨
2. å®ç° `parse_file` æ–¹æ³•
3. åœ¨ `services/docreader/src/parser/parser.py` æ³¨å†Œ

### 3. å®šåˆ¶èŠå¤©æµæ°´çº¿
1. åœ¨ `internal/application/service/chat_pipline/` æ·»åŠ æ’ä»¶
2. å®ç° `Plugin` æ¥å£
3. æ³¨å†Œåˆ°äº‹ä»¶ç®¡ç†å™¨
4. é…ç½®äº‹ä»¶å¤„ç†é“¾

##  è°ƒè¯•å’Œç›‘æ§

### 1. æ—¥å¿—ç³»ç»Ÿ
- åç«¯ä½¿ç”¨ structured logging
- è¯·æ±‚ ID è¿½è¸ªæ”¯æŒ
- æ—¥å¿—çº§åˆ«å¯é…ç½®

### 2. åˆ†å¸ƒå¼è¿½è¸ª
- é›†æˆ OpenTelemetry
- Jaeger UI: http://localhost:16686
- å®Œæ•´çš„è¯·æ±‚é“¾è·¯è¿½è¸ª

### 3. å¥åº·æ£€æŸ¥
- æœåŠ¡å¥åº·æ£€æŸ¥ç«¯ç‚¹: `/health`
- æ•°æ®åº“è¿æ¥çŠ¶æ€ç›‘æ§
- gRPC å¥åº·æ£€æŸ¥æ”¯æŒ

##  ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. è®¤è¯æˆæƒ
- JWT Token è®¤è¯
- ç§Ÿæˆ·çº§åˆ«çš„æ•°æ®éš”ç¦»
- API Key è®¿é—®æ§åˆ¶

### 2. æ•°æ®å®‰å…¨
- æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡é…ç½®
- æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥
- SQL æ³¨å…¥é˜²æŠ¤

### 3. éƒ¨ç½²å®‰å…¨
- å†…ç½‘éƒ¨ç½²æ¨è
- é˜²ç«å¢™è§„åˆ™é…ç½®
- å®šæœŸå®‰å…¨æ›´æ–°

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–
- å‘é‡ç´¢å¼•ä¼˜åŒ–
- æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–
- è¿æ¥æ± é…ç½®

### 2. æ£€ç´¢ä¼˜åŒ–
- åˆ†å—ç­–ç•¥è°ƒä¼˜
- ç¼“å­˜ç­–ç•¥å®ç°
- å¼‚æ­¥å¤„ç†ä¼˜åŒ–

### 3. å‰ç«¯ä¼˜åŒ–
- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- å›¾ç‰‡ä¼˜åŒ–å’Œå‹ç¼©
- API è¯·æ±‚åˆå¹¶

---

## ğŸ“š è¿›ä¸€æ­¥é˜…è¯»

- [å®˜æ–¹æ–‡æ¡£](./docs/WeKnora.md) - å®Œæ•´çš„åŠŸèƒ½è¯´æ˜
- [API æ–‡æ¡£](./docs/API.md) - è¯¦ç»†çš„æ¥å£æ–‡æ¡£
- [QA æ–‡æ¡£](./docs/QA.md) - å¸¸è§é—®é¢˜è§£ç­”

## ğŸ¤ è´¡çŒ®æŒ‡å—

é¡¹ç›®é‡‡ç”¨æ ‡å‡†çš„ Git å·¥ä½œæµï¼š
1. Fork é¡¹ç›®åˆ°ä¸ªäººè´¦æˆ·
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`feature/feature-name`)
3. æäº¤ä»£ç å˜æ›´
4. åˆ›å»º Pull Request
5. ä»£ç å®¡æŸ¥å’Œåˆå¹¶

éµå¾ª Conventional Commits è§„èŒƒæäº¤æ¶ˆæ¯ã€‚